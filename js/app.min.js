function Voronoi(){this.edges=null,this.cells=null,this.beachsectionJunkyard=[],this.circleEventJunkyard=[]}Voronoi.prototype.reset=function(){if(this.beachline||(this.beachline=new this.RBTree),this.beachline.root)for(var e=this.beachline.getFirst(this.beachline.root);e;)this.beachsectionJunkyard.push(e),e=e.rbNext;this.beachline.root=null,this.circleEvents||(this.circleEvents=new this.RBTree),this.circleEvents.root=this.firstCircleEvent=null,this.edges=[],this.cells=[]},Voronoi.prototype.sqrt=Math.sqrt,Voronoi.prototype.abs=Math.abs,Voronoi.prototype.EPSILON=1e-9,Voronoi.prototype.equalWithEpsilon=function(e,t){return this.abs(e-t)<1e-9},Voronoi.prototype.greaterThanWithEpsilon=function(e,t){return e-t>1e-9},Voronoi.prototype.greaterThanOrEqualWithEpsilon=function(e,t){return 1e-9>t-e},Voronoi.prototype.lessThanWithEpsilon=function(e,t){return t-e>1e-9},Voronoi.prototype.lessThanOrEqualWithEpsilon=function(e,t){return 1e-9>e-t},Voronoi.prototype.RBTree=function(){this.root=null},Voronoi.prototype.RBTree.prototype.rbInsertSuccessor=function(e,t){var r;if(e){if(t.rbPrevious=e,t.rbNext=e.rbNext,e.rbNext&&(e.rbNext.rbPrevious=t),e.rbNext=t,e.rbRight){for(e=e.rbRight;e.rbLeft;)e=e.rbLeft;e.rbLeft=t}else e.rbRight=t;r=e}else this.root?(e=this.getFirst(this.root),t.rbPrevious=null,t.rbNext=e,e.rbPrevious=t,e.rbLeft=t,r=e):(t.rbPrevious=t.rbNext=null,this.root=t,r=null);t.rbLeft=t.rbRight=null,t.rbParent=r,t.rbRed=!0;var i,o;for(e=t;r&&r.rbRed;)i=r.rbParent,r===i.rbLeft?(o=i.rbRight,o&&o.rbRed?(r.rbRed=o.rbRed=!1,i.rbRed=!0,e=i):(e===r.rbRight&&(this.rbRotateLeft(r),e=r,r=e.rbParent),r.rbRed=!1,i.rbRed=!0,this.rbRotateRight(i))):(o=i.rbLeft,o&&o.rbRed?(r.rbRed=o.rbRed=!1,i.rbRed=!0,e=i):(e===r.rbLeft&&(this.rbRotateRight(r),e=r,r=e.rbParent),r.rbRed=!1,i.rbRed=!0,this.rbRotateLeft(i))),r=e.rbParent;this.root.rbRed=!1},Voronoi.prototype.RBTree.prototype.rbRemoveNode=function(e){e.rbNext&&(e.rbNext.rbPrevious=e.rbPrevious),e.rbPrevious&&(e.rbPrevious.rbNext=e.rbNext),e.rbNext=e.rbPrevious=null;var t,r=e.rbParent,i=e.rbLeft,o=e.rbRight;t=i?o?this.getFirst(o):i:o,r?r.rbLeft===e?r.rbLeft=t:r.rbRight=t:this.root=t;var n;if(i&&o?(n=t.rbRed,t.rbRed=e.rbRed,t.rbLeft=i,i.rbParent=t,t!==o?(r=t.rbParent,t.rbParent=e.rbParent,e=t.rbRight,r.rbLeft=e,t.rbRight=o,o.rbParent=t):(t.rbParent=r,r=t,e=t.rbRight)):(n=e.rbRed,e=t),e&&(e.rbParent=r),!n){if(e&&e.rbRed)return void(e.rbRed=!1);var s;do{if(e===this.root)break;if(e===r.rbLeft){if(s=r.rbRight,s.rbRed&&(s.rbRed=!1,r.rbRed=!0,this.rbRotateLeft(r),s=r.rbRight),s.rbLeft&&s.rbLeft.rbRed||s.rbRight&&s.rbRight.rbRed){s.rbRight&&s.rbRight.rbRed||(s.rbLeft.rbRed=!1,s.rbRed=!0,this.rbRotateRight(s),s=r.rbRight),s.rbRed=r.rbRed,r.rbRed=s.rbRight.rbRed=!1,this.rbRotateLeft(r),e=this.root;break}}else if(s=r.rbLeft,s.rbRed&&(s.rbRed=!1,r.rbRed=!0,this.rbRotateRight(r),s=r.rbLeft),s.rbLeft&&s.rbLeft.rbRed||s.rbRight&&s.rbRight.rbRed){s.rbLeft&&s.rbLeft.rbRed||(s.rbRight.rbRed=!1,s.rbRed=!0,this.rbRotateLeft(s),s=r.rbLeft),s.rbRed=r.rbRed,r.rbRed=s.rbLeft.rbRed=!1,this.rbRotateRight(r),e=this.root;break}s.rbRed=!0,e=r,r=r.rbParent}while(!e.rbRed);e&&(e.rbRed=!1)}},Voronoi.prototype.RBTree.prototype.rbRotateLeft=function(e){var t=e,r=e.rbRight,i=t.rbParent;i?i.rbLeft===t?i.rbLeft=r:i.rbRight=r:this.root=r,r.rbParent=i,t.rbParent=r,t.rbRight=r.rbLeft,t.rbRight&&(t.rbRight.rbParent=t),r.rbLeft=t},Voronoi.prototype.RBTree.prototype.rbRotateRight=function(e){var t=e,r=e.rbLeft,i=t.rbParent;i?i.rbLeft===t?i.rbLeft=r:i.rbRight=r:this.root=r,r.rbParent=i,t.rbParent=r,t.rbLeft=r.rbRight,t.rbLeft&&(t.rbLeft.rbParent=t),r.rbRight=t},Voronoi.prototype.RBTree.prototype.getFirst=function(e){for(;e.rbLeft;)e=e.rbLeft;return e},Voronoi.prototype.RBTree.prototype.getLast=function(e){for(;e.rbRight;)e=e.rbRight;return e},Voronoi.prototype.Cell=function(e){this.site=e,this.halfedges=[]},Voronoi.prototype.Cell.prototype.prepare=function(){for(var e,t=this.halfedges,r=t.length;r--;)e=t[r].edge,e.vb&&e.va||t.splice(r,1);return t.sort(function(e,t){return t.angle-e.angle}),t.length},Voronoi.prototype.Vertex=function(e,t){this.x=e,this.y=t},Voronoi.prototype.Edge=function(e,t){this.lSite=e,this.rSite=t,this.va=this.vb=null},Voronoi.prototype.Halfedge=function(e,t,r){if(this.site=t,this.edge=e,r)this.angle=Math.atan2(r.y-t.y,r.x-t.x);else{var i=e.va,o=e.vb;this.angle=e.lSite===t?Math.atan2(o.x-i.x,i.y-o.y):Math.atan2(i.x-o.x,o.y-i.y)}},Voronoi.prototype.Halfedge.prototype.getStartpoint=function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},Voronoi.prototype.Halfedge.prototype.getEndpoint=function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va},Voronoi.prototype.createEdge=function(e,t,r,i){var o=new this.Edge(e,t);return this.edges.push(o),r&&this.setEdgeStartpoint(o,e,t,r),i&&this.setEdgeEndpoint(o,e,t,i),this.cells[e.voronoiId].halfedges.push(new this.Halfedge(o,e,t)),this.cells[t.voronoiId].halfedges.push(new this.Halfedge(o,t,e)),o},Voronoi.prototype.createBorderEdge=function(e,t,r){var i=new this.Edge(e,null);return i.va=t,i.vb=r,this.edges.push(i),i},Voronoi.prototype.setEdgeStartpoint=function(e,t,r,i){e.va||e.vb?e.lSite===r?e.vb=i:e.va=i:(e.va=i,e.lSite=t,e.rSite=r)},Voronoi.prototype.setEdgeEndpoint=function(e,t,r,i){this.setEdgeStartpoint(e,r,t,i)},Voronoi.prototype.Beachsection=function(){},Voronoi.prototype.createBeachsection=function(e){var t=this.beachsectionJunkyard.pop();return t||(t=new this.Beachsection),t.site=e,t},Voronoi.prototype.leftBreakPoint=function(e,t){var r=e.site,i=r.x,o=r.y,n=o-t;if(!n)return i;var s=e.rbPrevious;if(!s)return-(1/0);r=s.site;var h=r.x,a=r.y,b=a-t;if(!b)return h;var c=h-i,l=1/n-1/b,f=c/b;return l?(-f+this.sqrt(f*f-2*l*(c*c/(-2*b)-a+b/2+o-n/2)))/l+i:(i+h)/2},Voronoi.prototype.rightBreakPoint=function(e,t){var r=e.rbNext;if(r)return this.leftBreakPoint(r,t);var i=e.site;return i.y===t?i.x:1/0},Voronoi.prototype.detachBeachsection=function(e){this.detachCircleEvent(e),this.beachline.rbRemoveNode(e),this.beachsectionJunkyard.push(e)},Voronoi.prototype.removeBeachsection=function(e){var t=e.circleEvent,r=t.x,i=t.ycenter,o=new this.Vertex(r,i),n=e.rbPrevious,s=e.rbNext,h=[e],a=Math.abs;this.detachBeachsection(e);for(var b=n;b.circleEvent&&a(r-b.circleEvent.x)<1e-9&&a(i-b.circleEvent.ycenter)<1e-9;)n=b.rbPrevious,h.unshift(b),this.detachBeachsection(b),b=n;h.unshift(b),this.detachCircleEvent(b);for(var c=s;c.circleEvent&&a(r-c.circleEvent.x)<1e-9&&a(i-c.circleEvent.ycenter)<1e-9;)s=c.rbNext,h.push(c),this.detachBeachsection(c),c=s;h.push(c),this.detachCircleEvent(c);var l,f=h.length;for(l=1;f>l;l++)c=h[l],b=h[l-1],this.setEdgeStartpoint(c.edge,b.site,c.site,o);b=h[0],c=h[f-1],c.edge=this.createEdge(b.site,c.site,void 0,o),this.attachCircleEvent(b),this.attachCircleEvent(c)},Voronoi.prototype.addBeachsection=function(e){for(var t,r,i,o,n=e.x,s=e.y,h=this.beachline.root;h;)if(i=this.leftBreakPoint(h,s)-n,i>1e-9)h=h.rbLeft;else{if(o=n-this.rightBreakPoint(h,s),!(o>1e-9)){i>-1e-9?(t=h.rbPrevious,r=h):o>-1e-9?(t=h,r=h.rbNext):t=r=h;break}if(!h.rbRight){t=h;break}h=h.rbRight}var a=this.createBeachsection(e);if(this.beachline.rbInsertSuccessor(t,a),t||r){if(t===r)return this.detachCircleEvent(t),r=this.createBeachsection(t.site),this.beachline.rbInsertSuccessor(a,r),a.edge=r.edge=this.createEdge(t.site,a.site),this.attachCircleEvent(t),void this.attachCircleEvent(r);if(t&&!r)return void(a.edge=this.createEdge(t.site,a.site));if(t!==r){this.detachCircleEvent(t),this.detachCircleEvent(r);var b=t.site,c=b.x,l=b.y,f=e.x-c,p=e.y-l,u=r.site,d=u.x-c,v=u.y-l,g=2*(f*v-p*d),y=f*f+p*p,R=d*d+v*v,x=new this.Vertex((v*y-p*R)/g+c,(f*R-d*y)/g+l);return this.setEdgeStartpoint(r.edge,b,u,x),a.edge=this.createEdge(b,e,void 0,x),r.edge=this.createEdge(e,u,void 0,x),this.attachCircleEvent(t),void this.attachCircleEvent(r)}}},Voronoi.prototype.CircleEvent=function(){},Voronoi.prototype.attachCircleEvent=function(e){var t=e.rbPrevious,r=e.rbNext;if(t&&r){var i=t.site,o=e.site,n=r.site;if(i!==n){var s=o.x,h=o.y,a=i.x-s,b=i.y-h,c=n.x-s,l=n.y-h,f=2*(a*l-b*c);if(!(f>=-2e-12)){var p=a*a+b*b,u=c*c+l*l,d=(l*p-b*u)/f,v=(a*u-c*p)/f,g=v+h,y=this.circleEventJunkyard.pop();y||(y=new this.CircleEvent),y.arc=e,y.site=o,y.x=d+s,y.y=g+this.sqrt(d*d+v*v),y.ycenter=g,e.circleEvent=y;for(var R=null,x=this.circleEvents.root;x;)if(y.y<x.y||y.y===x.y&&y.x<=x.x){if(!x.rbLeft){R=x.rbPrevious;break}x=x.rbLeft}else{if(!x.rbRight){R=x;break}x=x.rbRight}this.circleEvents.rbInsertSuccessor(R,y),R||(this.firstCircleEvent=y)}}}},Voronoi.prototype.detachCircleEvent=function(e){var t=e.circleEvent;t&&(t.rbPrevious||(this.firstCircleEvent=t.rbNext),this.circleEvents.rbRemoveNode(t),this.circleEventJunkyard.push(t),e.circleEvent=null)},Voronoi.prototype.connectEdge=function(e,t){var r=e.vb;if(r)return!0;var i,o,n=e.va,s=t.xl,h=t.xr,a=t.yt,b=t.yb,c=e.lSite,l=e.rSite,f=c.x,p=c.y,u=l.x,d=l.y,v=(f+u)/2,g=(p+d)/2;if(d!==p&&(i=(f-u)/(d-p),o=g-i*v),void 0===i){if(s>v||v>=h)return!1;if(f>u){if(n){if(n.y>=b)return!1}else n=new this.Vertex(v,a);r=new this.Vertex(v,b)}else{if(n){if(n.y<a)return!1}else n=new this.Vertex(v,b);r=new this.Vertex(v,a)}}else if(-1>i||i>1)if(f>u){if(n){if(n.y>=b)return!1}else n=new this.Vertex((a-o)/i,a);r=new this.Vertex((b-o)/i,b)}else{if(n){if(n.y<a)return!1}else n=new this.Vertex((b-o)/i,b);r=new this.Vertex((a-o)/i,a)}else if(d>p){if(n){if(n.x>=h)return!1}else n=new this.Vertex(s,i*s+o);r=new this.Vertex(h,i*h+o)}else{if(n){if(n.x<s)return!1}else n=new this.Vertex(h,i*h+o);r=new this.Vertex(s,i*s+o)}return e.va=n,e.vb=r,!0},Voronoi.prototype.clipEdge=function(e,t){var r=e.va.x,i=e.va.y,o=e.vb.x,n=e.vb.y,s=0,h=1,a=o-r,b=n-i,c=r-t.xl;if(0===a&&0>c)return!1;var l=-c/a;if(0>a){if(s>l)return!1;h>l&&(h=l)}else if(a>0){if(l>h)return!1;l>s&&(s=l)}if(c=t.xr-r,0===a&&0>c)return!1;if(l=c/a,0>a){if(l>h)return!1;l>s&&(s=l)}else if(a>0){if(s>l)return!1;h>l&&(h=l)}if(c=i-t.yt,0===b&&0>c)return!1;if(l=-c/b,0>b){if(s>l)return!1;h>l&&(h=l)}else if(b>0){if(l>h)return!1;l>s&&(s=l)}if(c=t.yb-i,0===b&&0>c)return!1;if(l=c/b,0>b){if(l>h)return!1;l>s&&(s=l)}else if(b>0){if(s>l)return!1;h>l&&(h=l)}return s>0&&(e.va=new this.Vertex(r+s*a,i+s*b)),1>h&&(e.vb=new this.Vertex(r+h*a,i+h*b)),!0},Voronoi.prototype.clipEdges=function(e){for(var t,r=this.edges,i=r.length,o=Math.abs;i--;)t=r[i],(!this.connectEdge(t,e)||!this.clipEdge(t,e)||o(t.va.x-t.vb.x)<1e-9&&o(t.va.y-t.vb.y)<1e-9)&&(t.va=t.vb=null,r.splice(i,1))},Voronoi.prototype.closeCells=function(e){for(var t,r,i,o,n,s,h,a,b,c,l=e.xl,f=e.xr,p=e.yt,u=e.yb,d=this.cells,v=d.length,g=Math.abs;v--;)if(t=d[v],t.prepare())for(o=t.halfedges,n=o.length,r=0;n>r;)i=(r+1)%n,a=o[r].getEndpoint(),h=o[i].getStartpoint(),(g(a.x-h.x)>=1e-9||g(a.y-h.y)>=1e-9)&&(b=a,this.equalWithEpsilon(a.x,l)&&this.lessThanWithEpsilon(a.y,u)?c=new this.Vertex(l,this.equalWithEpsilon(h.x,l)?h.y:u):this.equalWithEpsilon(a.y,u)&&this.lessThanWithEpsilon(a.x,f)?c=new this.Vertex(this.equalWithEpsilon(h.y,u)?h.x:f,u):this.equalWithEpsilon(a.x,f)&&this.greaterThanWithEpsilon(a.y,p)?c=new this.Vertex(f,this.equalWithEpsilon(h.x,f)?h.y:p):this.equalWithEpsilon(a.y,p)&&this.greaterThanWithEpsilon(a.x,l)&&(c=new this.Vertex(this.equalWithEpsilon(h.y,p)?h.x:l,p)),s=this.createBorderEdge(t.site,b,c),o.splice(r+1,0,new this.Halfedge(s,t.site,null)),n=o.length),r++},Voronoi.prototype.compute=function(e,t){var r=new Date;this.reset();var i=e.slice(0);i.sort(function(e,t){var r=t.y-e.y;return r?r:t.x-e.x});for(var o,n=i.pop(),s=0,h=Number.MIN_VALUE,a=Number.MIN_VALUE,b=this.cells;;)if(o=this.firstCircleEvent,n&&(!o||n.y<o.y||n.y===o.y&&n.x<o.x))(n.x!==h||n.y!==a)&&(b[s]=new this.Cell(n),n.voronoiId=s++,this.addBeachsection(n),a=n.y,h=n.x),n=i.pop();else{if(!o)break;this.removeBeachsection(o.arc)}this.clipEdges(t),this.closeCells(t);var c=new Date,l={cells:this.cells,edges:this.edges,execTime:c.getTime()-r.getTime()};return this.reset(),l};